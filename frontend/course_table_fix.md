# 课程表修复方案文档

## 一、课程信息字段定义

| 字段名称 | 数据类型 | 描述 | 备注 |
|---------|---------|------|------|
| 课程名称 | 字符串 | 课程的中文名称 | 必填 |
| 课程代码 | 字符串 | 课程的唯一标识符 | 必填，不可重复 |
| 课程类型 | 枚举 | 必修 / 选修 | 必填 |
| 授课方式 | 枚举 | 线上 / 线下 | 必填 |
| 学分 | 数值 | 课程学分 | 必填，通常为0.5-5之间的数值 |
| 总课时 | 整数 | 课程总课时数 | 必填 |
| 任课教师 | 多对多关联 | 教授该课程的教师 | 支持多名教师共同教授一门课程 |
| 上课教室 | 外键关联 | 仅限线下课程使用的教室 | 线上课程可为空或显示为"-" |
| 总人数上限 | 整数 | 课程可容纳的最大学生数 | 线上课程固定为1000，线下课程取教室容量 |
| 已选人数 | 整数 | 当前已选择该课程的学生数 | 初始为0，选课成功后自动加1 |

## 二、教师表与课程表绑定关系

### 关系定义
- 支持一对多：一个教师可以教授多门课程
- 支持多对多：多名教师可以共同教授一门课程

### 实现方式
- 通过多对多关联表（如TeachingAssignment）实现教师与课程的双向关联
- 教师可以绑定自己所授课程，课程也可以关联多个任课教师

## 三、教室表与课程表的绑定信息

### 教室表字段
| 字段名称 | 数据类型 | 描述 |
|---------|---------|------|
| 教室编号/名称 | 字符串 | 教室的唯一标识符 |
| 教室位置 | 字符串 | 教室所在楼栋和楼层信息 |
| 教室容量 | 整数 | 教室可容纳的最大人数 |

### 绑定逻辑
- 仅线下课程需要关联教室
- 课程在分配教室时，自动读取教室的capacity作为课程的max_students值
- 若课程授课方式改为线上，自动清空教室关联并将max_students设置为1000

## 四、学生选课逻辑

### 选课流程
1. 学生发起选课请求
2. 系统校验课程人数是否已满（current_students < max_students）
3. 若未满，执行选课操作，current_students + 1
4. 若已满，系统提示"选课人数已达上限"，拒绝选课请求

### 约束条件
- 确保选课操作的原子性，避免并发情况下的超员问题
- 选课成功后，同时在学生选课记录和课程已选人数中进行更新

## 完成情况

| 需求项 | 完成状态 | 备注 |
|-------|---------|------|
| 课程信息字段设计 | ✅ 已完成 | 数据库模型已包含所需字段 |
| 教师-课程多对多关联 | ✅ 已完成 | 通过TeachingAssignment表实现 |
| 教室-课程关联及容量限制 | ✅ 已完成 | 课程表中包含教室外键，容量自动同步 |
| 学生选课人数校验 | ✅ 已完成 | 已在选课API中实现完整的人数校验逻辑，包含并发控制 |
| 线上课程固定容量1000 | ✅ 已完成 | 已在模型中实现自动设置逻辑 |